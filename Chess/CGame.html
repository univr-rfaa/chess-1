<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Chess::CGame - Chess</title>

<link href="../fonts.css" rel="stylesheet">
<link href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/search_index.js"></script>
<script src="../js/search.js"></script>
<script src="../js/searcher.js"></script>
<script src="../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-5B-5D">#[]</a>
    
    <li ><a href="#method-i-board">#board</a>
    
    <li ><a href="#method-i-current">#current</a>
    
    <li ><a href="#method-i-draw">#draw</a>
    
    <li ><a href="#method-i-each">#each</a>
    
    <li ><a href="#method-i-full_moves">#full_moves</a>
    
    <li ><a href="#method-i-move">#move</a>
    
    <li ><a href="#method-i-move2">#move2</a>
    
    <li ><a href="#method-i-move3">#move3</a>
    
    <li ><a href="#method-i-moves">#moves</a>
    
    <li ><a href="#method-i-resign">#resign</a>
    
    <li ><a href="#method-i-result">#result</a>
    
    <li ><a href="#method-i-rollback-21">#rollback!</a>
    
    <li ><a href="#method-i-set_fen-21">#set_fen!</a>
    
    <li ><a href="#method-i-size">#size</a>
    
    <li ><a href="#method-i-threefold_repetition-3F">#threefold_repetition?</a>
    
    <li ><a href="#method-i-to_s">#to_s</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Chess::CGame">
  <h1 id="class-Chess::CGame" class="class">
    class Chess::CGame
  </h1>

  <section class="description">
    
<p>This class rappresents a collection of boards of a single chess game.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-5B-5D" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            [n]
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Returns the <code>n</code>-th <a href="Board.html">Board</a> of the <a
href="Game.html">Game</a> or <code>nil</code> if the <code>n</code>-th <a
href="Board.html">Board</a> does not exist.</p>
          
          

          
          <div class="method-source-code" id="5B-5D-source">
            <pre>VALUE
game_boards (VALUE self, VALUE index)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  int n = FIX2INT (index);
  Board *board = get_board (g, n);
  if (board)
    return Data_Wrap_Struct (board_klass, 0, 0, board);
  return Qnil;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-board" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">board</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="CGame.html#method-i-current">current</a>
        </div>
        
      </div>

    
      <div id="method-i-current" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            current
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Returns the current <a href="Board.html">Board</a> of the <a
href="Game.html">Game</a> (the current chess position of the game).</p>
          
          

          
          <div class="method-source-code" id="current-source">
            <pre>VALUE
game_current_board (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  return game_boards (self, INT2FIX (g-&gt;current-1));
}</pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="CGame.html#method-i-board">board</a>
        </div>
        

        
      </div>

    
      <div id="method-i-draw" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            draw
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>The game result is set to draw.</p>
          
          

          
          <div class="method-source-code" id="draw-source">
            <pre>VALUE
game_draw (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  g-&gt;result = DRAW;
  return Qnil;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-each" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            each { |board, move, full_move, index| block }
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Calls <code>block</code> once for each <code>board</code> in self, passing
that <code>board</code>, <code>move</code>, <code>full_move</code> and
<code>index</code> as parameters. Return self. If no block is given, the
array of game moves is returned instead.</p>
          
          

          
          <div class="method-source-code" id="each-source">
            <pre>VALUE
game_each (VALUE self)
{
  if (!rb_block_given_p ())
    return game_moves(self);
  int i;
  Game *g;
  Data_Get_Struct (self, Game, g);
  for (i = 0; i &lt; g-&gt;current; i++)
    rb_yield_values (4, Data_Wrap_Struct (board_klass, 0, 0, get_board (g, i)),
                     rb_str_new2 (g-&gt;moves[i]), rb_str_new2 (g-&gt;full_moves[i]),
                     INT2FIX (i));
  return self;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-full_moves" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            full_moves
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Returns the array with all full moves done <em>(es: b1c3)</em>.</p>
          
          

          
          <div class="method-source-code" id="full_moves-source">
            <pre>VALUE
game_full_moves (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  int i;
  VALUE moves = rb_ary_new ();
  for (i = 0; i &lt; g-&gt;current; i++)
    rb_ary_push (moves, rb_str_new2 (g-&gt;full_moves[i]));
  return moves;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-move" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            move(piece, disambiguating, to_coord, promote_in)
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Make a move. This add a new <a href="Board.html">Board</a> in the <a
href="Game.html">Game</a>.</p>

<p>Parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>piece</code>
<dd>
<p>the character of the moving piece <em>(&#39;P&#39;, &#39;R&#39;,
&#39;N&#39;, &#39;B&#39;, &#39;Q&#39;, &#39;K&#39;)</em>.</p>
</dd><dt><code>disambiguating</code>
<dd>
<p>when two (or more) identical pieces can move to the same square, the moving
piece is uniquely identified by specifying the piece&#39;s letter, followed
by (in descending order of preference):</p>
<ol><li>
<p>the file of departure (if they differ); or</p>
</li><li>
<p>the rank of departure (if the files are the same but the ranks differ); or</p>
</li><li>
<p>both the rank and file (if neither alone is sufficient to identify the
piece—which occurs only in rare cases where one or more pawns have
promoted, resulting in a player having three or more identical pieces able
to reach the same square).</p>
</li></ol>

<p>Keep blank if no needed.</p>
</dd><dt><code>to_coord</code>
<dd>
<p>the square where the moving piece will <em>(&#39;a1&#39;, &#39;a2&#39;, … ,
&#39;h7&#39;, &#39;h8&#39;)</em>.</p>
</dd><dt><code>promote_in</code>
<dd>
<p>the character of promotion piece <em>(&#39;R&#39;, &#39;N&#39;,
&#39;B&#39;, &#39;Q&#39;)</em>. If no promotion occured, this param will be
ignored.</p>
</dd></dl>

<p>This method returns a string that represents the short algebraic chess
notation of the move or raise an <a
href="IllegalMoveError.html">IllegalMoveError</a> if the move is illegal.</p>
          
          

          
          <div class="method-source-code" id="move-source">
            <pre>VALUE
game_move (VALUE self, VALUE rb_piece, VALUE rb_disambiguating, VALUE rb_to_coord, VALUE rb_promote_in)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  Board *board = current_board (g);
  char piece = StringValuePtr (rb_piece)[0];
  char *disambiguating = StringValuePtr (rb_disambiguating);
  char *to_coord = StringValuePtr (rb_to_coord);
  char promote_in = StringValuePtr (rb_promote_in)[0];
  int from, to;
  get_coord (board, piece, disambiguating, to_coord, promote_in, &amp;from, &amp;to);
  // printf (&quot;From: %d, To: %d, Promo: %c\n&quot;, from , to , promote_in);
  if (pseudo_legal_move (board, from, to) &amp;&amp; apply_move (g, from, to, promote_in))
    return rb_str_new2 (current_move (g));
  else
    rb_raise (illegal_move_error, &quot;Illegal move&quot;);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-move2" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            move2(from, to, promote_in)
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Make a move. This add a new <a href="Board.html">Board</a> in the <a
href="Game.html">Game</a>.</p>

<p>Parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>from</code>
<dd>
<p>the 2 character string representing the starting square of the moving piece
<em>(&#39;a1&#39;, &#39;a2&#39;, … , &#39;h7&#39;, &#39;h8&#39;)</em>.</p>
</dd><dt><code>to</code>
<dd>
<p>the 2 character string representing the ending square of the moving piece
<em>(&#39;a1&#39;, &#39;a2&#39;, … , &#39;h7&#39;, &#39;h8&#39;)</em>.</p>
</dd><dt><code>promote_in</code>
<dd>
<p>the character of promotion piece <em>(&#39;R&#39;, &#39;N&#39;,
&#39;B&#39;, &#39;Q&#39;)</em>. If no promotion occured, this param will be
ignored.</p>
</dd></dl>

<p>This method returns a string that represents the short algebraic chess
notation of the move or raise an <a
href="IllegalMoveError.html">IllegalMoveError</a> if the move is illegal.</p>
          
          

          
          <div class="method-source-code" id="move2-source">
            <pre>VALUE
game_move2 (VALUE self, VALUE rb_from, VALUE rb_to, VALUE rb_promote_in)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  Board *board = current_board (g);
  int from = coord_to_square (StringValuePtr (rb_from));
  int to = coord_to_square (StringValuePtr (rb_to));
  char promote_in = StringValuePtr (rb_promote_in)[0];
  if (pseudo_legal_move (board, from, to) &amp;&amp; apply_move (g, from, to, promote_in))
    return rb_str_new2 (current_move (g));
  else
    rb_raise (illegal_move_error, &quot;Illegal move&quot;);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-move3" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            move3(from, to, promote_in)
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Make a move. This add a new <a href="Board.html">Board</a> in the <a
href="Game.html">Game</a>.</p>

<p>Each square on the chessboard is represented by an integer according to the
following scheme:</p>

<pre>8 | 56 57 58 59 60 61 62 63
7 | 48 49 50 51 52 53 54 55
6 | 40 41 42 43 44 45 46 47
5 | 32 33 34 35 36 37 38 39
4 | 24 25 26 27 28 29 30 31
3 | 16 17 18 19 20 21 22 23
2 |  8  9 10 11 12 13 14 15
1 |  0  1  2  3  4  5  6  7
  +-------------------------
     a  b  c  d  e  f  g  h</pre>

<p>Parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>from</code>
<dd>
<p>the integer representing the starting square of the moving piece.</p>
</dd><dt><code>to</code>
<dd>
<p>the integer representing the ending square of the moving piece.</p>
</dd><dt><code>promote_in</code>
<dd>
<p>the character of promotion piece <em>(&#39;R&#39;, &#39;N&#39;,
&#39;B&#39;, &#39;Q&#39;)</em>. If no promotion occured, this param will be
ignored.</p>
</dd></dl>

<p>This method returns a string that represents the short algebraic chess
notation of the move or raise an <a
href="IllegalMoveError.html">IllegalMoveError</a> if the move is illegal.</p>
          
          

          
          <div class="method-source-code" id="move3-source">
            <pre>VALUE
game_move3 (VALUE self, VALUE rb_from, VALUE rb_to, VALUE rb_promote_in)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  Board *board = current_board (g);
  int from = FIX2INT (rb_from);
  int to = FIX2INT (rb_to);
  char promote_in = StringValuePtr (rb_promote_in)[0];
  if (pseudo_legal_move (board, from, to) &amp;&amp; apply_move (g, from, to, promote_in))
    return rb_str_new2 (current_move (g));
  else
    rb_raise (illegal_move_error, &quot;Illegal move&quot;);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-moves" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            moves
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Returns the array with all moves done <em>(es: Nc3)</em>.</p>
          
          

          
          <div class="method-source-code" id="moves-source">
            <pre>VALUE
game_moves (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  int i;
  VALUE moves = rb_ary_new ();
  for (i = 0; i &lt; g-&gt;current; i++)
    rb_ary_push (moves, rb_str_new2 (g-&gt;moves[i]));
  return moves;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-resign" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            resign(color)
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>The game result is set to &#39;1-0&#39; if <code>color</code> is “black”,
otherwise is set to &#39;0-1&#39; if color is “white”.</p>

<p>Parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>color</code>
<dd>
<p>the color of the player who resigns the game; it can be <code>:white</code>
or <code>:black</code>.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="resign-source">
            <pre>VALUE
game_resign (VALUE self, VALUE color)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  const char *c;
  if (TYPE (color) == T_SYMBOL)
    c = rb_id2name (SYM2ID (color));
  else
    c = StringValuePtr (color);
  if (strcmp (c, &quot;black&quot;) == 0)
    g-&gt;result = WHITE_WON;
  else if (strcmp (c, &quot;white&quot;) == 0)
    g-&gt;result = BLACK_WON;
  return Qnil;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-result" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            result
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Returns the result of the game:</p>
<dl class="rdoc-list note-list"><dt>*
<dd>
<p>game in progress;</p>
</dd><dt>1-0
<dd>
<p>white won;</p>
</dd><dt>0-1
<dd>
<p>black won;</p>
</dd><dt>1/2-1/2
<dd>
<p>draw</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="result-source">
            <pre>VALUE
game_result (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  char *result = result_to_s (g-&gt;result);
  VALUE rb_result = rb_str_new2 (result);
  free (result);
  return rb_result;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-rollback-21" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            rollback!
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Rollback last move.</p>
          
          

          
          <div class="method-source-code" id="rollback-21-source">
            <pre>VALUE
game_rollback (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  rollback (g);
  return self;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-set_fen-21" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            set_fen!(fen)
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Set the game position with a FEN string.</p>

<p>Parameters are:</p>
<dl class="rdoc-list note-list"><dt><code>fen</code>
<dd>
<p>the FEN (Forsyth–Edwards Notation) string notation used to set the game
position.</p>
</dd></dl>
          
          

          
          <div class="method-source-code" id="set_fen-21-source">
            <pre>VALUE
game_set_fen (VALUE self, VALUE fen)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  set_fen (g, StringValuePtr (fen));
  return self;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-size" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            size
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Returns the number of moves done.</p>
          
          

          
          <div class="method-source-code" id="size-source">
            <pre>VALUE
game_size (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  return INT2FIX (g-&gt;current);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-threefold_repetition-3F" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            threefold_repetition?
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Returns <code>true</code> if a player can claim draw by the threefold
repetition rule, <code>false</code> otherwise.</p>
          
          

          
          <div class="method-source-code" id="threefold_repetition-3F-source">
            <pre>VALUE
game_threefold_repetition (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  if (threefold_repetition (g))
    return Qtrue;
  else
    return Qfalse;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-to_s" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            to_s
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Current board to string.</p>
          
          

          
          <div class="method-source-code" id="to_s-source">
            <pre>VALUE
game_to_s (VALUE self)
{
  Game *g;
  Data_Get_Struct (self, Game, g);
  Board *b = get_board (g, g-&gt;current-1);
  char *s = print_board (b);
  VALUE rb_s = rb_str_new2 (s);
  free (s);
  return rb_s;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

